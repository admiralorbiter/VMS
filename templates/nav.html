{#
Navigation Template - Main Site Navigation
=========================================

This template provides the primary navigation bar for the Volunteer Management System.
It includes responsive design, user authentication checks, and dynamic menu items.

Key Features:
- Responsive Bootstrap navigation with mobile hamburger menu
- User authentication-based menu items
- Side navigation panel for additional options
- Bug report modal integration with HTMX
- Admin-only menu items
- Brand/logo display with security level indicator

Navigation Structure:
- Main navbar with primary navigation links
- Side panel with additional admin functions
- Mobile-responsive design
- Dynamic content based on user permissions

User States:
- Authenticated users: Full navigation with logout
- Unauthenticated users: Login link only
- Admin users: Additional admin-only menu items

HTMX Integration:
- Bug report modal loading via HTMX
- Dynamic content swapping
- Non-intrusive form submission

Template Variables:
- current_user: Current authenticated user object
- current_user.is_authenticated: Boolean for auth status
- current_user.is_admin: Boolean for admin status
- current_user.security_level: User's security level display

Dependencies:
- Bootstrap 5.3.3 CSS/JS
- FontAwesome icons
- HTMX library
- Custom nav.js for side panel functionality
#}

<nav class="navbar navbar-expand-lg custom-nav">
  <div class="container-fluid">
    <div class="navbar-brand-container">
      <a class="navbar-brand" href="/">Polaris</a>
      {% set role_icons = {
      -1: "ğŸ‘ï¸",
      0: "ğŸ§‘",
      1: "ğŸ§‘â€ğŸ«",
      2: "ğŸ§‘â€ğŸ’¼",
      3: "ğŸ›¡ï¸"
      } %}

      {% set role_labels = {
      -1: "KCK Viewer",
      0: "User",
      1: "Supervisor",
      2: "Manager",
      3: "Admin"
      } %}

      <small class="tagline">
        Our North Star
        <span title="{{ role_labels[current_user.security_level] }}">
          {{ role_icons[current_user.security_level] }}
        </span>
      </small>

    </div>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
      aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        {% if current_user.is_authenticated %}
        {% if current_user.scope_type == 'district' and current_user.allowed_districts %}
        {# Simplified navigation for district-scoped viewers #}
        {% set districts = current_user.allowed_districts|from_json %}
        {% if districts and districts|length > 0 %}
        <li class="nav-item">
          <a class="nav-link"
            href="{{ url_for('virtual.virtual_district_teacher_progress', district_name=districts[0], year='2025-2026', date_from='2025-08-01', date_to='2026-07-31') }}">District
            Progress</a>
        </li>
        {% endif %}
        <li class="nav-item">
          <a class="nav-link" href="/admin">
            <i class="fas fa-cog"></i> Change Password
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/logout">Logout</a>
        </li>
        {% elif current_user.tenant_id %}
        {# Tenant User Navigation (FR-TENANT-112) #}
        <li class="nav-item">
          <a class="nav-link" href="{{ url_for('district.list_events') }}">Events</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="{{ url_for('district.list_volunteers') }}">Volunteers</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="{{ url_for('district.recruitment_dashboard') }}">Recruitment</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="{{ url_for('district.settings') }}">Settings</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/logout">Logout</a>
        </li>
        {% else %}
        {# Full navigation for Polaris admins #}
        <li class="nav-item">
          <a class="nav-link" href="/volunteers">Volunteers</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/events">Events</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/organizations">Orgs</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/virtual/usage">Virtual</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/reports">Reports</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/calendar">Calendar</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#" id="moreMenuToggle">
            More <i class="fas fa-chevron-right"></i>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/logout">Logout</a>
        </li>
        {% endif %}
        {% else %}
        <li class="nav-item">
          <a class="nav-link" href="/login">Login</a>
        </li>
        {% endif %}
      </ul>
    </div>
  </div>
</nav>

{# Side Navigation Panel - Additional menu items (hidden for KCK viewers and tenant users) #}
{% if not current_user.is_kck_viewer and not current_user.tenant_id %}
<div class="side-nav-panel" id="sideNavPanel">
  <div class="side-nav-content">
    <ul class="side-nav-menu">
      <li><a href="/admin" class="side-nav-link">Admin</a></li>
      {% if current_user.is_admin %}
      <li><a href="/history_table" class="side-nav-link">History</a></li>
      <li><a href="/schools" class="side-nav-link">Schools</a></li>
      <li><a href="{{ url_for('client_projects.index') }}" class="side-nav-link">Client Projects</a></li>
      <li class="nav-item">
        <a class="nav-link" href="/attendance">Attendance</a>
      </li>
      <li><a href="/quality_dashboard" class="side-nav-link">Data Quality</a></li>
      {% endif %}
      <li class="nav-item">
        <a class="nav-link" href="#" hx-get="/bug-report/form" hx-target="#bugReportModal" hx-trigger="click"
          hx-swap="innerHTML">
          <i class="fas fa-bug"></i>
        </a>
      </li>
      <!-- Add more items as needed -->
    </ul>
  </div>
</div>
{% endif %}

{# Bug Report Modal Container - HTMX target for dynamic content #}
<div id="bugReportModal" class="modal" tabindex="-1">
  <!-- Modal content will be loaded here -->
</div>
