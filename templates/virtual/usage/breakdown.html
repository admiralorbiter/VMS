{% extends "base.html" %}

{% block title %}Virtual Sessions Detailed Breakdown{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/reports.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/virtual_usage.css') }}">
<style>
/* Modern Design System */
:root {
    --primary: #6366f1;
    --primary-dark: #4f46e5;
    --secondary: #f8fafc;
    --accent: #06b6d4;
    --success: #10b981;
    --warning: #f59e0b;
    --error: #ef4444;
    --text-primary: #1e293b;
    --text-secondary: #64748b;
    --text-muted: #94a3b8;
    --border: #e2e8f0;
    --border-light: #f1f5f9;
    --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
    --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
    --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
    --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
}

/* Base Styles */
.breakdown-container {
    max-width: 100%;
    margin: 0 auto;
    padding: 0;
    background: var(--secondary);
    min-height: 100vh;
}

/* Modern Header */
.breakdown-header {
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    color: white;
    padding: 3rem 2rem;
    margin-bottom: 0;
    position: relative;
    overflow: hidden;
}

.breakdown-header::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Ccircle cx='30' cy='30' r='2'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
    opacity: 0.3;
}

.back-link {
    color: rgba(255, 255, 255, 0.9);
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 1.5rem;
    font-weight: 500;
    font-size: 0.95rem;
    transition: all 0.2s ease;
    position: relative;
    z-index: 1;
}

.back-link:hover {
    color: white;
    transform: translateX(-2px);
}

.breakdown-title {
    margin: 0 0 0.5rem 0;
    font-size: 2.75rem;
    font-weight: 800;
    letter-spacing: -0.025em;
    position: relative;
    z-index: 1;
}

.breakdown-subtitle {
    margin: 0.25rem 0;
    opacity: 0.9;
    font-size: 1.1rem;
    font-weight: 400;
    position: relative;
    z-index: 1;
}

/* Modern Filters */
.filters-section {
    background: white;
    padding: 2rem;
    margin: 2rem;
    border-radius: 1rem;
    box-shadow: var(--shadow);
    border: 1px solid var(--border-light);
}

.filters-form {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    align-items: end;
}

.filter-group label {
    font-weight: 600;
    color: var(--text-primary);
    font-size: 0.9rem;
    margin-bottom: 0.5rem;
    display: block;
}

.filter-group select,
.filter-group input {
    padding: 0.75rem 1rem;
    border: 1px solid var(--border);
    border-radius: 0.75rem;
    font-size: 0.95rem;
    transition: all 0.2s ease;
    background: white;
}

.filter-group select:focus,
.filter-group input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
}

.filter-actions {
    display: flex;
    gap: 1rem;
    align-items: center;
    grid-column: 1 / -1;
    margin-top: 1.5rem;
}

.filter-btn, .reset-btn {
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: 0.75rem;
    cursor: pointer;
    font-weight: 600;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    transition: all 0.2s ease;
    font-size: 0.95rem;
}

.filter-btn {
    background: var(--primary);
    color: white;
}

.filter-btn:hover {
    background: var(--primary-dark);
    transform: translateY(-1px);
    box-shadow: var(--shadow-lg);
}

.reset-btn {
    background: var(--text-muted);
    color: white;
}

.reset-btn:hover {
    background: var(--text-secondary);
    transform: translateY(-1px);
}

/* Modern Legend */
.legend {
    background: white;
    padding: 2rem;
    border-radius: 1rem;
    margin: 0 2rem 2rem 2rem;
    box-shadow: var(--shadow);
    border: 1px solid var(--border-light);
}

.legend h3 {
    margin: 0 0 1.5rem 0;
    font-size: 1.5rem;
    color: var(--text-primary);
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.legend h3::before {
    content: 'ðŸ“Š';
    font-size: 1.25rem;
}

.legend-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 1.25rem;
}

.legend-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem;
    border-radius: 0.75rem;
    background: var(--border-light);
    transition: all 0.2s ease;
}

.legend-item:hover {
    background: var(--border);
    transform: translateX(4px);
}

.legend-color {
    width: 1rem;
    height: 1rem;
    border-radius: 0.25rem;
    flex-shrink: 0;
}

.legend-color.completed { background: var(--success); }
.legend-color.simulcast { background: var(--accent); }
.legend-color.teacher-canceled { background: var(--warning); }
.legend-color.teacher-no-show { background: #f97316; }
.legend-color.pathful-canceled { background: var(--error); }
.legend-color.local-canceled { background: #ec4899; }
.legend-color.unfilled { background: var(--text-muted); }

/* Modern Table */
.breakdown-table-container {
    background: white;
    border-radius: 1rem;
    box-shadow: var(--shadow-lg);
    overflow: hidden;
    margin: 0 2rem 2rem 2rem;
    border: 1px solid var(--border-light);
}

.breakdown-table thead {
    height: auto;
}

.breakdown-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.9rem;
}

.breakdown-table th,
.breakdown-table td {
    padding: 1rem 0.75rem;
    text-align: center;
    border-bottom: 1px solid var(--border-light);
    border-right: 1px solid var(--border-light);
    white-space: nowrap;
    font-size: 0.95rem;
}

.breakdown-table th:not(.month-column) {
    white-space: normal;
}

.breakdown-table th {
    background: var(--secondary);
    font-weight: 700;
    color: var(--text-primary);
    font-size: 0.85rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    position: sticky;
    top: 0;
    z-index: 10;
}

.breakdown-table .month-column {
    text-align: left;
    font-weight: 700;
    background: var(--secondary);
    position: sticky;
    left: 0;
    z-index: 5;
    min-width: 120px;
    padding: 1rem 1.5rem;
    color: var(--text-primary);
}

.breakdown-table .ytd-row {
    background: var(--primary);
    font-weight: 700;
    color: white;
}

.breakdown-table .ytd-row td {
    border-top: 2px solid var(--primary-dark);
    font-size: 1.1rem;
}

.breakdown-table .ytd-row .month-column {
    background: var(--primary);
    color: white;
}

.breakdown-table tbody tr:hover {
    background: var(--border-light);
}

.breakdown-table tbody tr:hover .month-column {
    background: var(--border);
}

.category-header {
    writing-mode: horizontal-tb;
    text-orientation: mixed;
    min-width: 120px;
    max-width: 140px;
    min-height: auto;
    word-wrap: break-word;
    text-align: center;
    vertical-align: middle;
    font-size: 0.75rem;
    line-height: 1.2;
    padding: 1rem 0.5rem;
    white-space: normal;
    overflow-wrap: break-word;
    hyphens: auto;
    font-weight: 600;
}

.category-header[title] {
    cursor: help;
}

/* Modern Cell Styles */
.number-cell {
    font-weight: 700;
    color: var(--primary);
}

.zero-cell {
    color: var(--text-muted);
    font-weight: 500;
}

.positive-cell {
    color: var(--success);
    font-weight: 700;
}

.negative-cell {
    color: var(--error);
    font-weight: 700;
}

.table-scroll {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    border-radius: 1rem;
}

/* Modern Analytics */
.analytics-sections {
    margin: 0 2rem 2rem 2rem;
    padding: 0;
}

.analytics-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
    gap: 2rem;
    margin-top: 0;
}

.analytics-card {
    background: white;
    border-radius: 1rem;
    box-shadow: var(--shadow);
    padding: 2rem;
    border: 1px solid var(--border-light);
    transition: all 0.2s ease;
}

.analytics-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
}

.analytics-card h3 {
    margin: 0 0 1.5rem 0;
    color: var(--text-primary);
    font-size: 1.4rem;
    font-weight: 700;
    padding-bottom: 1rem;
    border-bottom: 2px solid var(--primary);
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.analytics-card h3::before {
    content: 'ðŸ“ˆ';
    font-size: 1.25rem;
}

.stats-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 1rem;
}

.stat-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 0;
    border-bottom: 1px solid var(--border-light);
    transition: all 0.2s ease;
}

.stat-item:hover {
    background: var(--border-light);
    margin: 0 -1rem;
    padding: 1rem;
    border-radius: 0.5rem;
}

.stat-item:last-child {
    border-bottom: none;
}

.stat-item.total-row {
    border-top: 2px solid var(--primary);
    font-weight: 700;
    background: var(--secondary);
    padding: 1.25rem 0;
    margin-top: 1rem;
    border-radius: 0.5rem;
}

.stat-label {
    color: var(--text-secondary);
    font-weight: 500;
    flex: 1;
}

.stat-value {
    color: var(--primary);
    font-weight: 700;
    font-size: 1.1rem;
    min-width: 60px;
    text-align: right;
}

.comparison-grid {
    display: grid;
    grid-template-columns: 2fr 1fr 1fr;
    gap: 1rem;
}

.comparison-header {
    display: contents;
    font-weight: 700;
    color: var(--text-primary);
}

.comparison-header > span {
    padding: 1rem 0.75rem;
    background: var(--secondary);
    border-bottom: 2px solid var(--primary);
    text-align: center;
    border-radius: 0.5rem 0.5rem 0 0;
}

.comparison-header > span:first-child {
    text-align: left;
}

.comparison-row {
    display: contents;
}

.comparison-row > span {
    padding: 0.75rem;
    border-bottom: 1px solid var(--border-light);
    display: flex;
    align-items: center;
}

.comparison-label {
    color: var(--text-secondary);
    font-weight: 500;
    justify-content: flex-start;
}

.comparison-value {
    color: var(--primary);
    font-weight: 700;
    justify-content: center;
    text-align: center;
}

/* Responsive Design */
@media (max-width: 768px) {
    .breakdown-header {
        padding: 2rem 1rem;
    }

    .breakdown-title {
        font-size: 2rem;
    }

    .filters-section,
    .legend,
    .breakdown-table-container,
    .analytics-sections {
        margin: 1rem;
    }

    .filters-form {
        grid-template-columns: 1fr;
    }

    .breakdown-table {
        font-size: 0.8rem;
    }

    .breakdown-table th,
    .breakdown-table td {
        padding: 0.75rem 0.5rem;
    }

    .category-header {
        min-width: 80px;
        max-width: 100px;
        min-height: auto;
        font-size: 0.7rem;
        padding: 0.75rem 0.25rem;
    }

    .breakdown-table .month-column {
        min-width: 80px;
        padding: 0.75rem 1rem;
    }

    .legend-grid {
        grid-template-columns: 1fr;
    }

    .analytics-grid {
        grid-template-columns: 1fr;
        gap: 1.5rem;
    }

    .analytics-card {
        padding: 1.5rem;
    }

    .comparison-grid {
        grid-template-columns: 1fr;
        gap: 0.5rem;
    }

    .comparison-header > span,
    .comparison-row > span {
        padding: 0.75rem;
    }

    .comparison-header {
        display: none;
    }

    .comparison-row {
        display: grid;
        grid-template-columns: 2fr 1fr 1fr;
        gap: 0.75rem;
        margin-bottom: 0.75rem;
        background: var(--secondary);
        border-radius: 0.5rem;
        padding: 0.75rem;
    }
}

/* Smooth Scrolling */
html {
    scroll-behavior: smooth;
}

/* Custom Scrollbar */
.table-scroll::-webkit-scrollbar {
    height: 8px;
}

.table-scroll::-webkit-scrollbar-track {
    background: var(--border-light);
    border-radius: 4px;
}

.table-scroll::-webkit-scrollbar-thumb {
    background: var(--text-muted);
    border-radius: 4px;
}

.table-scroll::-webkit-scrollbar-thumb:hover {
    background: var(--text-secondary);
}
</style>
{% endblock %}

{% block content %}
<div class="breakdown-container">
    <div class="breakdown-header">
        <a href="{{ url_for('virtual.virtual_usage', year=current_filters.year, date_from=current_filters.date_from.strftime('%Y-%m-%d') if current_filters.date_from else '', date_to=current_filters.date_to.strftime('%Y-%m-%d') if current_filters.date_to else '') }}" class="back-link">
            <i class="fas fa-arrow-left"></i> Back to Virtual Usage Report
        </a>
        <h1 class="breakdown-title">Virtual Sessions Detailed Breakdown</h1>
        <p class="breakdown-subtitle">Virtual Year: {{ current_filters.year }}</p>
        <p class="breakdown-subtitle">Date Range: {{ current_filters.date_from.strftime('%Y-%m-%d') }} to {{ current_filters.date_to.strftime('%Y-%m-%d') }}</p>
    </div>

    <!-- Filter Section -->
    <div class="filters-section">
        <form class="filters-form" method="GET">
            <div class="filter-group">
                <label for="year">Virtual Year:</label>
                <select id="year" name="year">
                    {% for virtual_year in virtual_year_options %}
                        <option value="{{ virtual_year }}" {% if virtual_year == current_filters.year %}selected{% endif %}>
                            {{ virtual_year }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <div class="filter-group">
                <label for="date_from">From:</label>
                <input type="date" id="date_from" name="date_from"
                       value="{{ current_filters.date_from.strftime('%Y-%m-%d') if current_filters.date_from }}">
            </div>

            <div class="filter-group">
                <label for="date_to">To:</label>
                <input type="date" id="date_to" name="date_to"
                       value="{{ current_filters.date_to.strftime('%Y-%m-%d') if current_filters.date_to }}">
            </div>

            <div class="filter-actions">
                <button type="submit" class="filter-btn">Apply Filters</button>
                <a href="{{ url_for('virtual.virtual_breakdown') }}" class="reset-btn">Reset</a>
            </div>
        </form>
    </div>

    <!-- Legend -->
    <div class="legend">
        <h3>Category Definitions</h3>
        <div class="legend-grid">
            <div class="legend-item">
                <div class="legend-color completed"></div>
                <span><strong>Successfully Completed:</strong> Sessions marked as completed</span>
            </div>
            <div class="legend-item">
                <div class="legend-color simulcast"></div>
                <span><strong>Simulcast Sessions:</strong> Sessions broadcast to multiple locations</span>
            </div>
            <div class="legend-item">
                <div class="legend-color teacher-canceled"></div>
                <span><strong>Teacher Canceled:</strong> Sessions canceled by participating teachers</span>
            </div>
            <div class="legend-item">
                <div class="legend-color teacher-no-show"></div>
                <span><strong>Teacher No-Shows:</strong> Registered teachers who didn't attend</span>
            </div>
            <div class="legend-item">
                <div class="legend-color pathful-canceled"></div>
                <span><strong>Pathful Professional Issues:</strong> All Pathful professional cancellations and no-shows</span>
            </div>
            <div class="legend-item">
                <div class="legend-color local-canceled"></div>
                <span><strong>Local Professional Issues:</strong> All local professional cancellations and no-shows</span>
            </div>
            <div class="legend-item">
                <div class="legend-color unfilled"></div>
                <span><strong>Unfilled Sessions:</strong> Sessions with no available professionals</span>
            </div>
            <div class="legend-item">
                <div class="legend-color simulcast"></div>
                <span><strong>Local Volunteer Fill % (Sessions Only):</strong> Percentage of completed sessions filled by local volunteers</span>
            </div>
            <div class="legend-item">
                <div class="legend-color simulcast"></div>
                <span><strong>Local Volunteer Fill % (Sessions + Simulcast):</strong> Percentage of completed + simulcast sessions filled by local volunteers</span>
            </div>
            <div class="legend-item">
                <div class="legend-color simulcast"></div>
                <span><strong>POC Volunteer Fill % (Sessions Only):</strong> Percentage of completed sessions filled by volunteers of color</span>
            </div>
            <div class="legend-item">
                <div class="legend-color simulcast"></div>
                <span><strong>POC Volunteer Fill % (Sessions + Simulcast):</strong> Percentage of completed + simulcast sessions filled by volunteers of color</span>
            </div>
        </div>
    </div>

    <!-- Breakdown Table -->
    <div class="breakdown-table-container">
        <div class="table-scroll">
            <table class="breakdown-table">
                <thead>
                    <tr>
                        <th class="month-column">Month</th>
                        <th class="category-header" title="Sessions marked as completed">Completed</th>
                        <th class="category-header" title="Sessions broadcast to multiple locations">Simulcast</th>
                        <th class="category-header" title="Sessions canceled by participating teachers">Teacher Canceled</th>
                        <th class="category-header" title="Registered teachers who didn't attend">Teacher No-Shows</th>
                        <th class="category-header" title="All Pathful professional cancellations and no-shows">Pathful Issues</th>
                        <th class="category-header" title="All local professional cancellations and no-shows">Local Issues</th>
                        <th class="category-header" title="Sessions with no available professionals">Unfilled</th>
                        <th class="category-header" title="Percentage of completed sessions filled by local volunteers (KS/MO). Raw session count shown in cell as smaller text.">Local % (Sessions)</th>
                        <th class="category-header" title="Percentage of completed + simulcast sessions filled by local volunteers. Raw session count shown in cell as smaller text.">Local % (Sessions + Simulcast)</th>
                        <th class="category-header" title="Percentage of completed sessions filled by volunteers of color (POC). Raw session count shown in cell as smaller text.">POC % (Sessions)</th>
                        <th class="category-header" title="Percentage of completed + simulcast sessions filled by volunteers of color (POC). Raw session count shown in cell as smaller text.">POC % (Sessions + Simulcast)</th>
                    </tr>
                </thead>
                <tbody>
                    {% for year, month_num, month_name in months %}
                        {% set month_key = "%04d-%02d"|format(year, month_num) %}
                        {% set month_data = monthly_breakdown.get(month_key, {}) %}
                        <tr>
                            <td class="month-column">{{ month_name }}</td>
                            <td class="{% if month_data.get('successfully_completed', 0) > 0 %}positive-cell{% else %}zero-cell{% endif %}">
                                {{ month_data.get('successfully_completed', 0) }}
                            </td>
                            <td class="{% if month_data.get('simulcast_sessions', 0) > 0 %}number-cell{% else %}zero-cell{% endif %}">
                                {{ month_data.get('simulcast_sessions', 0) }}
                            </td>
                            <td class="{% if month_data.get('teacher_canceled', 0) > 0 %}negative-cell{% else %}zero-cell{% endif %}">
                                {{ month_data.get('teacher_canceled', 0) }}
                            </td>
                            <td class="{% if month_data.get('teacher_no_shows', 0) > 0 %}negative-cell{% else %}zero-cell{% endif %}">
                                {{ month_data.get('teacher_no_shows', 0) }}
                            </td>
                            <td class="{% if month_data.get('pathful_professional_canceled_no_shows', 0) > 0 %}negative-cell{% else %}zero-cell{% endif %}">
                                {{ month_data.get('pathful_professional_canceled_no_shows', 0) }}
                            </td>
                            <td class="{% if month_data.get('local_professional_canceled_no_shows', 0) > 0 %}negative-cell{% else %}zero-cell{% endif %}">
                                {{ month_data.get('local_professional_canceled_no_shows', 0) }}
                            </td>
                            <td class="{% if month_data.get('unfilled_sessions', 0) > 0 %}negative-cell{% else %}zero-cell{% endif %}">
                                {{ month_data.get('unfilled_sessions', 0) }}
                            </td>
                            <td class="{% if month_data.get('local_volunteer_percentage_sessions_only', 0) > 0 %}number-cell{% else %}zero-cell{% endif %}">
                                {{ month_data.get('local_volunteer_percentage_sessions_only', 0) }}%
                                {% if month_data.get('local_volunteer_count_sessions_only', 0) > 0 %}
                                    <br><small>({{ month_data.get('local_volunteer_count_sessions_only', 0) }} sessions)</small>
                                {% endif %}
                            </td>
                            <td class="{% if month_data.get('local_volunteer_percentage_sessions_simulcast', 0) > 0 %}number-cell{% else %}zero-cell{% endif %}">
                                {{ month_data.get('local_volunteer_percentage_sessions_simulcast', 0) }}%
                                {% if month_data.get('local_volunteer_count_sessions_simulcast', 0) > 0 %}
                                    <br><small>({{ month_data.get('local_volunteer_count_sessions_simulcast', 0) }} sessions)</small>
                                {% endif %}
                            </td>
                            <td class="{% if month_data.get('poc_volunteer_percentage_sessions_only', 0) > 0 %}number-cell{% else %}zero-cell{% endif %}">
                                {{ month_data.get('poc_volunteer_percentage_sessions_only', 0) }}%
                                {% if month_data.get('poc_volunteer_count_sessions_only', 0) > 0 %}
                                    <br><small>({{ month_data.get('poc_volunteer_count_sessions_only', 0) }} sessions)</small>
                                {% endif %}
                            </td>
                            <td class="{% if month_data.get('poc_volunteer_percentage_sessions_simulcast', 0) > 0 %}number-cell{% else %}zero-cell{% endif %}">
                                {{ month_data.get('poc_volunteer_percentage_sessions_simulcast', 0) }}%
                                {% if month_data.get('poc_volunteer_count_sessions_simulcast', 0) > 0 %}
                                    <br><small>({{ month_data.get('poc_volunteer_count_sessions_simulcast', 0) }} sessions)</small>
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}

                    <!-- Year to Date Row -->
                    <tr class="ytd-row">
                        <td class="month-column">Year to Date</td>
                        <td class="{% if ytd_totals.get('successfully_completed', 0) > 0 %}positive-cell{% else %}zero-cell{% endif %}">
                            {{ ytd_totals.get('successfully_completed', 0) }}
                        </td>
                        <td class="{% if ytd_totals.get('simulcast_sessions', 0) > 0 %}number-cell{% else %}zero-cell{% endif %}">
                            {{ ytd_totals.get('simulcast_sessions', 0) }}
                        </td>
                        <td class="{% if ytd_totals.get('teacher_canceled', 0) > 0 %}negative-cell{% else %}zero-cell{% endif %}">
                            {{ ytd_totals.get('teacher_canceled', 0) }}
                        </td>
                        <td class="{% if ytd_totals.get('teacher_no_shows', 0) > 0 %}negative-cell{% else %}zero-cell{% endif %}">
                            {{ ytd_totals.get('teacher_no_shows', 0) }}
                        </td>
                        <td class="{% if ytd_totals.get('pathful_professional_canceled_no_shows', 0) > 0 %}negative-cell{% else %}zero-cell{% endif %}">
                            {{ ytd_totals.get('pathful_professional_canceled_no_shows', 0) }}
                        </td>
                        <td class="{% if ytd_totals.get('local_professional_canceled_no_shows', 0) > 0 %}negative-cell{% else %}zero-cell{% endif %}">
                            {{ ytd_totals.get('local_professional_canceled_no_shows', 0) }}
                        </td>
                        <td class="{% if ytd_totals.get('unfilled_sessions', 0) > 0 %}negative-cell{% else %}zero-cell{% endif %}">
                            {{ ytd_totals.get('unfilled_sessions', 0) }}
                        </td>
                        <td class="{% if ytd_totals.get('local_volunteer_percentage_sessions_only', 0) > 0 %}number-cell{% else %}zero-cell{% endif %}">
                            {{ ytd_totals.get('local_volunteer_percentage_sessions_only', 0) }}%
                            {% if ytd_totals.get('local_volunteer_count_sessions_only', 0) > 0 %}
                                <br><small>({{ ytd_totals.get('local_volunteer_count_sessions_only', 0) }} sessions)</small>
                            {% endif %}
                        </td>
                        <td class="{% if ytd_totals.get('local_volunteer_percentage_sessions_simulcast', 0) > 0 %}number-cell{% else %}zero-cell{% endif %}">
                            {{ ytd_totals.get('local_volunteer_percentage_sessions_simulcast', 0) }}%
                            {% if ytd_totals.get('local_volunteer_count_sessions_simulcast', 0) > 0 %}
                                <br><small>({{ ytd_totals.get('local_volunteer_count_sessions_simulcast', 0) }} sessions)</small>
                            {% endif %}
                        </td>
                        <td class="{% if ytd_totals.get('poc_volunteer_percentage_sessions_only', 0) > 0 %}number-cell{% else %}zero-cell{% endif %}">
                            {{ ytd_totals.get('poc_volunteer_percentage_sessions_only', 0) }}%
                            {% if ytd_totals.get('poc_volunteer_count_sessions_only', 0) > 0 %}
                                <br><small>({{ ytd_totals.get('poc_volunteer_count_sessions_only', 0) }} sessions)</small>
                            {% endif %}
                        </td>
                        <td class="{% if ytd_totals.get('poc_volunteer_percentage_sessions_simulcast', 0) > 0 %}number-cell{% else %}zero-cell{% endif %}">
                            {{ ytd_totals.get('poc_volunteer_percentage_sessions_simulcast', 0) }}%
                            {% if ytd_totals.get('poc_volunteer_count_sessions_simulcast', 0) > 0 %}
                                <br><small>({{ ytd_totals.get('poc_volunteer_count_sessions_simulcast', 0) }} sessions)</small>
                            {% endif %}
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Comprehensive Analytics Sections -->
<div class="analytics-sections">
    <div class="analytics-grid">
        <!-- Current Running Count -->
        <div class="analytics-card">
            <h3>Current Running Count</h3>
            <div class="stats-grid">
                <div class="stat-item">
                    <span class="stat-label">Unfilled</span>
                    <span class="stat-value">{{ running_count.unfilled }}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Successfully Completed</span>
                    <span class="stat-value">{{ running_count.successfully_completed }}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Teacher Cancelation</span>
                    <span class="stat-value">{{ running_count.teacher_cancelation }}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Formerly In-Person (Completed)</span>
                    <span class="stat-value">{{ running_count.formerly_in_person_completed }}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Formerly In-Person (Canceled)</span>
                    <span class="stat-value">{{ running_count.formerly_in_person_canceled }}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Professional Cancel/No-Show</span>
                    <span class="stat-value">{{ running_count.professional_cancel_no_show }}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Inclement Weather Cancellation</span>
                    <span class="stat-value">{{ running_count.inclement_weather_cancellation }}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Withdrawn--Time Constraint</span>
                    <span class="stat-value">{{ running_count.withdrawn_time_constraint }}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Moved to In-Person Session</span>
                    <span class="stat-value">{{ running_count.moved_to_in_person_session }}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Teacher No-Show</span>
                    <span class="stat-value">{{ running_count.teacher_no_show }}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">COVID19 Cancelation</span>
                    <span class="stat-value">{{ running_count.covid19_cancelation }}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">White Label Completed</span>
                    <span class="stat-value">{{ running_count.white_label_completed }}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">White Label Unfilled</span>
                    <span class="stat-value">{{ running_count.white_label_unfilled }}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Technical Difficulties</span>
                    <span class="stat-value">{{ running_count.technical_difficulties }}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Local Professional Cancellation</span>
                    <span class="stat-value">{{ running_count.local_professional_cancellation }}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Pathful Professional Cancellation</span>
                    <span class="stat-value">{{ running_count.pathful_professional_cancellation }}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Local Professional No-Show</span>
                    <span class="stat-value">{{ running_count.local_professional_no_show }}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Pathful Professional No-Show</span>
                    <span class="stat-value">{{ running_count.pathful_professional_no_show }}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Formerly In-Person (Duplicate)</span>
                    <span class="stat-value">{{ running_count.formerly_in_person_duplicate }}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">White Label Canceled</span>
                    <span class="stat-value">{{ running_count.white_label_canceled }}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Simulcast</span>
                    <span class="stat-value">{{ running_count.simulcast }}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Count</span>
                    <span class="stat-value">{{ running_count.count }}</span>
                </div>
            </div>
        </div>

        <!-- District Breakdown -->
        <div class="analytics-card">
            <h3>Running Totals for Successfully Completed Sessions by DISTRICT</h3>
            <div class="stats-grid">
                {% for district, count in district_completed.items() %}
                <div class="stat-item">
                    <span class="stat-label">{{ district }}</span>
                    <span class="stat-value">{{ count }}</span>
                </div>
                {% endfor %}
                <div class="stat-item total-row">
                    <span class="stat-label">TOTAL</span>
                    <span class="stat-value">{{ district_completed.values() | sum }}</span>
                </div>
            </div>
        </div>

        <!-- Topic Breakdown -->
        <div class="analytics-card">
            <h3>Total Sessions by Topic</h3>
            <div class="stats-grid">
                {% for topic, count in topic_counts.items() %}
                <div class="stat-item">
                    <span class="stat-label">{{ topic }}</span>
                    <span class="stat-value">{{ count }}</span>
                </div>
                {% endfor %}
                <div class="stat-item total-row">
                    <span class="stat-label">TOTAL</span>
                    <span class="stat-value">{{ topic_counts.values() | sum }}</span>
                </div>
            </div>
        </div>

        <!-- Session Type Breakdown -->
        <div class="analytics-card">
            <h3>Session Type</h3>
            <div class="comparison-grid">
                <div class="comparison-header">
                    <span>Type</span>
                    <span>All</span>
                    <span>Completed</span>
                </div>
                {% for session_type, data in session_types.items() %}
                <div class="comparison-row">
                    <span class="comparison-label">{{ session_type.replace('_', ' ').title() }}</span>
                    <span class="comparison-value">{{ data.all }}</span>
                    <span class="comparison-value">{{ data.completed }}</span>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Grade Level Breakdown -->
        <div class="analytics-card">
            <h3>Grade Level</h3>
            <div class="comparison-grid">
                <div class="comparison-header">
                    <span>Grade</span>
                    <span>All</span>
                    <span>Completed (No Simulcast)</span>
                </div>
                {% for grade, data in grade_levels.items() %}
                <div class="comparison-row">
                    <span class="comparison-label">{{ grade.replace('_', ' ').title() }}</span>
                    <span class="comparison-value">{{ data.all }}</span>
                    <span class="comparison-value">{{ data.completed_no_simulcast }}</span>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Teacher Attendance -->
        <div class="analytics-card">
            <h3>Teacher Attendance</h3>
            <div class="stats-grid">
                <div class="stat-item">
                    <span class="stat-label">More Than One Teacher Present</span>
                    <span class="stat-value">{{ teacher_attendance.more_than_one_teacher_present }}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Total Number of Sessions</span>
                    <span class="stat-value">{{ teacher_attendance.total_number_of_sessions }}</span>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}
